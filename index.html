<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Getting Started</title>
    <style>
        code {
            display: block;
            border: 1px solid black;
            height: 80vh;
        }
        .panel {
            display: grid;
            grid-template-columns: 100vh 1fr;
        }
    </style>
</head>
<body>

    <article class="panel">
        <aside class="panel__files">
            <ul id="fileList" class="file-list">

            </ul>
        </aside>
        <main class="main">
            <code id="container"></code>

            <input id="filename" type="text"/>

            <button id="save">Save</button>
        </main>
    </article>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/loader.min.js"></script>
    <script>

        function getHead(method = 'POST', data){
            const head = {
                method: method,
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                    'Content-Type': 'application/json'
                },
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer',
            }
            if(method === 'POST') {
                head.body = JSON.stringify(data)
            }
            return head;
        }
        async function postData(url = '/api', data = {}) {

            const response = await fetch(url, getHead('POST', data));

            return response.json();
        }

        async function getData(url = '/api', data = {}) {

            const response = await fetch(url, getHead('GET', data));

            return response.json();
        }

        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs' }});

        require(["vs/editor/editor.main"], () => {

            window.editor = monaco.editor.create(document.getElementById('container'), {
                value: `{}`,
                language: 'json',
                theme: 'vs-light',
            });

        });

        window.save.addEventListener('click', ()=>{
            const value = window.editor.getValue();
            const data = {
                value,
                fileName: window.filename.value,
            }

            postData('/api/addSchema', data)
                .then(data => {
                    console.log(data); // JSON data parsed by `data.json()` call
                    getSchemaFiles();
                });
        })

        function getSchemaFiles(){
            getData('/api/getSchemaFiles').then((data)=>{
                console.log(data);
                fileListToHTML(data)
            })
        }
        function fileTemplate(fileId, fileName){
            console.log(getFile);
            return `<div id="wrapper_${fileId}" class="file-item">
                 <input id="checkbox_${fileId}" type="checkbox" />
                 <button id="getFile_${fileId}" onclick="getFile('${fileName}')">${fileName}</button>
            </div>`
        }
        function updateFileItem(file){
            const listHTML = window.fileList;
            const li = document.createElement('li');
            li.innerHTML = fileTemplate(file.id, file.name);
            listHTML.appendChild(li)
        }
        function fileListToHTML(fileList){
            fileList.forEach(updateFileItem)
        }
        function getFile(fileName) {
            console.log(fileName);
            getData('/api/getSchemaFile/' + fileName).then((data)=>{
                console.log(data);
                editor.getModel().setValue(data);
            })
        }
        getSchemaFiles();

    </script>
</body>
</html>